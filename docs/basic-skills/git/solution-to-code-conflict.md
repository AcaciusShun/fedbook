# 问题：pull 时发现代码冲突，如何妥善解决

## 冲突产生的原因

多人协作的开发模式，在代码合并/更新代码时经常会遇到冲突的情况，最常见的是在 `push` 时，Git 发现本地修改的某个文件在远端也做了修改，那么就会提示需要先进行 `pull`。

`pull` 后会有两种情况：

* Git 自动做了合并（无需理会）
* 提示有文件存在冲突 - CONFLICT

还有一种情况就是同一个文件，在合并分支的时候，如果同一行被多个分支或者不同人都修改了，合并的时候也会出现冲突。

## 解决冲突的步骤

解决冲突需要自己去判断到底要保留远端代码还是本地代码或者两端都保留。

这个操作一般借助可视化工具进行比较方便，具体步骤如下：

* 查看冲突文件内容
* 确定冲突内容保留哪些部分，修改文件
* 重新提交，done

## 冲突标记介绍

Git 提示冲突后，我们切换到对应文件，可以看到冲突内容被标记出来了。

```bash
<<<<<<< HEAD:file.txt

Hello world

=======

Goodbye

>>>>>>> 77976da35a11db4580b80ae27e8d65caf5208086:file.txt
```

可以看到Git用 `<<<<<<<`，`=======`，`>>>>>>>` 将代码分成了三个区域。

* `<<<<<<< HEAD` 和 `=======` 之间的内容表示你本地的分支。
* `=======` 和 `>>>>>>>` 之间的表示本次 `pull` 下来或 `merge` 过来的内容。

## TODO...

需要仔细核对并确认 rebase 的用法，危险操作，不可以乱用

## 推荐操作

在多人协作的开发模式中，为了避免此类麻烦，我一般会有两个习惯：

* 准备开始编写代码了，先看看版本库里有没有别人提交的记录，不管怎样先在本地 `pull` 一下。
* 代码编写完成了，本地环境先 `commit`，然后 `pull`，再 `push`。

::: tip 为什么要先 commit，然后 pull，再push？
`commit` 是告诉 Git，这次提交改了哪些东西，不然只是自己改了，Git 不知道你改了，无从判断比较。  
`pull` 是为了本地 `commit` 和远程 `commit` 的对比记录，Git 按照文件的行数操作进行对比，如果同时操作了某文件的同一行那么就会产生冲突，这时候需要手动解决，保留本地分支代码还是保留远程分支代码。

本地代码进行 `commit` 后，仓库不会将本地代码与远程仓库代码进行比较，不会识别是否存在代码冲突，必须进行 `pull` 命令后，才会将本地代码与仓库远程代码进行比较，如果存在冲突，必须要解决冲突后重新 `commit` 和 `push`。不存在冲突，会在 `pull` 时直接合并代码，不会将本地代码覆盖掉。
:::

（未完）
